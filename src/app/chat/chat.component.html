<app-error *ngIf="!isValidWidth" [errorText]="'We do not support your Device!'"></app-error>
<div *ngIf="isValidWidth" class="container" fxLayout="column">
  <header fxLayout="row" fxLayoutAlign="space-between">

    <app-chat-dropdown [account]="account"></app-chat-dropdown>

    <div class="add-field">
      <div class="btn btn-primary btn-add" (click)="addChat()">
        +
      </div>
    </div>
  </header>

  <main fxLayout="row" fxLayoutAlign="space-between">
    <nav>
      <ul *ngIf="allChats" class="flex-md-column flex-row navbar-nav w-100">
        <li *ngFor="let chat of allChats; let i = index">
          <div [ngClass]="'nav-item'+getSelected(chat)"
               (click)="setCurrentChat(chat.chatWith)">
            {{ chat.chatWith}}
          </div>
        </li>
      </ul>
    </nav>

    <div class="chat-section" fxLayout="column" fxLayoutAlign="space-between">
      <div class="chat-field">
        <div *ngIf="getCurrentChat()" class="message-field" fxLayout="column">
          <div *ngFor="let addressable of getCurrentChat().addressableList">

            <ng-container *ngIf="isAMessage(addressable)">
              <app-message [message]="addressable" [account]="account"></app-message>
            </ng-container>

            <ng-container *ngIf="!isAMessage(addressable)">
              <app-file [file]="addressable" [account]="account"></app-file>
            </ng-container>

            {{scrollToBottom()}}
          </div>
        </div>
      </div>

      <form *ngIf="this.currentChat" class="input-group mb-3" (ngSubmit)="sendMessage(chatForm)" #chatForm="ngForm">
        <div class="input-group-prepend">
          <button class="input-group-text" id="inputGroupPrepend" (click)="openUploadFile()">
            <img class="file-icon" [src]="sanitizer.bypassSecurityTrustResourceUrl(icon.FILE)"/>
          </button>
        </div>
        <input type="text" class="form-control" ngModel required
               name="message" #message="ngModel"
               placeholder="Your text..."
               aria-describedby="basic-addon2">
        <div class="input-group-append">
          <button class="btn btn-secondary" type="submit" [disabled]=" this.isModalOpen">Send</button>
        </div>
      </form>
    </div>
  </main>
</div>
